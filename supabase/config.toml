# ============================================================
# FreyAI Visions — Supabase Project Configuration
# Zone 1: Database & Realtime
# ============================================================
# Local development: supabase start
# Production: link via `supabase link --project-ref <ref>`
# ============================================================

[api]
# Project name — used in local dev URLs
# Local API: http://localhost:54321
project_id = "freyai-visions"

[api.tls]
enabled = false

[db]
# Local Postgres port
port = 54322
# Shadow DB for migrations diff generation
shadow_port = 54320
major_version = 15

[db.pooler]
enabled = false
port = 54329
pool_mode = "transaction"
default_pool_size = 20
max_client_conn = 100

[realtime]
enabled = true
# Realtime IP version
ip_version = "IPv4"

# ============================================================
# Realtime table subscriptions
# All business entity tables + async job infrastructure
# ============================================================
# Note: Individual tables are added to supabase_realtime
# publication via the SQL migrations (003_rls_policies.sql
# and 002_jobs_queue.sql). The publication is managed in SQL
# to ensure correct ordering with table creation.
#
# Tables published to realtime:
#   - jobs_queue       (002_jobs_queue.sql)
#   - notifications    (002_jobs_queue.sql)
#   - customers        (003_rls_policies.sql)
#   - leads            (003_rls_policies.sql)
#   - quotes           (003_rls_policies.sql)
#   - orders           (003_rls_policies.sql)
#   - invoices         (003_rls_policies.sql)
#   - communications   (003_rls_policies.sql)
#   - materials        (003_rls_policies.sql)
#   - warehouse_entries (003_rls_policies.sql)
#   - time_entries     (003_rls_policies.sql)
#   - company_settings (003_rls_policies.sql)
# ============================================================

[storage]
enabled = true
# Max file upload size (50 MB — for invoice PDFs and images)
file_size_limit = "52428800"

[storage.image_transformation]
enabled = true

[auth]
enabled = true
# Local auth site URL
site_url = "http://localhost:3000"
additional_redirect_urls = [
    "https://freyai.app",
    "https://app.freyai.de",
    "freyai://login"
]
jwt_expiry = 3600
# Enable refresh token rotation for security
enable_refresh_token_rotation = true
refresh_token_reuse_interval = 10
enable_signup = true
# Minimum password length
minimum_password_length = 8
# Session inactivity timeout (8 hours)
max_session_length = "28800"

[auth.email]
enable_signup = true
double_confirm_changes = true
enable_confirmations = false   # set true in production

[auth.email.template.invite]
subject = "Du wurdest zu FreyAI Visions eingeladen"

[auth.email.template.confirmation]
subject = "Bestätige deine FreyAI Visions E-Mail"

[auth.email.template.recovery]
subject = "FreyAI Visions — Passwort zurücksetzen"

[auth.email.template.magic_link]
subject = "FreyAI Visions — Magic Link Login"

[auth.sms]
enable_signup = false
enable_confirmations = false

# ============================================================
# Edge Functions
# ============================================================
[functions]
# Functions are in supabase/functions/
# Deploy with: supabase functions deploy <name>

[functions.ai-proxy]
verify_jwt = true

[functions.check-overdue]
# Called by cron or scheduler — requires service_role
verify_jwt = false

[functions.create-checkout]
verify_jwt = true

[functions.create-checkout-session]
verify_jwt = true

[functions.create-portal-session]
verify_jwt = true

[functions.process-inbound-email]
# Inbound webhook from email provider — no user JWT
verify_jwt = false

[functions.run-automation]
verify_jwt = true

[functions.run-webhook]
verify_jwt = false

[functions.send-email]
verify_jwt = true

[functions.send-sms]
verify_jwt = true

[functions.stripe-webhook]
# Stripe signs its own webhooks
verify_jwt = false

# ============================================================
# Analytics (local dev stub)
# ============================================================
[analytics]
enabled = false
port = 54327
vector_port = 54328
backend = "postgres"

# ============================================================
# Studio (local Supabase Dashboard)
# ============================================================
[studio]
enabled = true
port = 54323
api_url = "http://localhost"
openai_api_key = "env(OPENAI_API_KEY)"

# ============================================================
# Inbucket (local email testing)
# ============================================================
[inbucket]
enabled = true
port = 54324
smtp_port = 54325
pop3_port = 54326

# ============================================================
# Local environment overrides
# Create supabase/.env.local (gitignored) for secrets:
#   SUPABASE_SERVICE_ROLE_KEY=...
#   STRIPE_SECRET_KEY=...
#   RESEND_API_KEY=...
# ============================================================
