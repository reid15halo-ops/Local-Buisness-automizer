<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <title>Termin buchen - FreyAI Visions</title>
    <link rel="stylesheet" href="css/fonts.css">
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --success: #22c55e;
            --error: #ef4444;
            --border: #475569;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .header {
            width: 100%;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        .header h1 { font-size: 24px; font-weight: 700; }
        .header p { color: var(--text-muted); font-size: 14px; margin-top: 4px; }
        .container {
            max-width: 600px;
            width: 100%;
            padding: 24px 16px;
        }
        .steps {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 32px;
        }
        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--bg-input);
            transition: all 0.3s;
        }
        .step-dot.active { background: var(--accent); transform: scale(1.3); }
        .step-dot.done { background: var(--success); }
        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
        }
        .card h2 { font-size: 18px; margin-bottom: 16px; }

        .service-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        @media (max-width: 480px) { .service-grid { grid-template-columns: 1fr; } }
        .service-card {
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .service-card:hover { border-color: var(--accent); }
        .service-card.selected { border-color: var(--accent); background: rgba(99, 102, 241, 0.15); }
        .service-card .icon { font-size: 28px; margin-bottom: 8px; }
        .service-card .name { font-weight: 600; font-size: 14px; }
        .service-card .meta { color: var(--text-muted); font-size: 12px; margin-top: 4px; }

        .date-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }
        .date-card {
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .date-card:hover { border-color: var(--accent); }
        .date-card.selected { border-color: var(--accent); background: rgba(99, 102, 241, 0.15); }
        .date-card .day { font-weight: 600; font-size: 14px; }
        .date-card .date { font-size: 12px; color: var(--text-muted); }
        .date-card .slots { font-size: 11px; color: var(--success); margin-top: 4px; }

        .time-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }
        .time-btn {
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 10px 18px;
            color: var(--text);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .time-btn:hover { border-color: var(--accent); }
        .time-btn.selected { border-color: var(--accent); background: rgba(99, 102, 241, 0.15); }

        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: var(--text-muted); }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 14px;
            font-family: inherit;
        }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: var(--accent); }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .form-group .required { color: var(--error); }
        .form-group .field-error { color: var(--error); font-size: 12px; margin-top: 2px; }

        .btn-row { display: flex; gap: 12px; margin-top: 24px; }
        .btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: var(--accent-hover); }
        .btn-secondary { background: var(--bg-input); color: var(--text); }
        .btn-secondary:hover { background: var(--border); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .confirmation {
            text-align: center;
            padding: 32px 16px;
        }
        .confirmation .check { font-size: 64px; margin-bottom: 16px; }
        .confirmation h2 { color: var(--success); margin-bottom: 12px; }
        .confirmation .code {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 2px;
            background: var(--bg-input);
            padding: 12px 24px;
            border-radius: 8px;
            display: inline-block;
            margin: 16px 0;
        }
        .summary-table { width: 100%; text-align: left; margin-top: 16px; }
        .summary-table td { padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 14px; }
        .summary-table td:first-child { color: var(--text-muted); width: 40%; }

        .footer {
            text-align: center;
            padding: 24px;
            color: var(--text-muted);
            font-size: 12px;
        }
        .footer a { color: var(--accent); text-decoration: none; }
    </style>
</head>
<body>
    <div class="header">
        <h1>FreyAI Visions</h1>
        <p>Online-Terminbuchung</p>
    </div>

    <div class="container">
        <div class="steps">
            <div class="step-dot active" data-step="1"></div>
            <div class="step-dot" data-step="2"></div>
            <div class="step-dot" data-step="3"></div>
            <div class="step-dot" data-step="4"></div>
        </div>

        <!-- Step 1: Service Selection -->
        <div class="step active" id="step-1">
            <div class="card">
                <h2>Leistung ausw√§hlen</h2>
                <div class="service-grid" id="service-list"></div>
            </div>
            <div class="btn-row">
                <button class="btn btn-primary" id="btn-to-step2" disabled>Weiter</button>
            </div>
        </div>

        <!-- Step 2: Date & Time -->
        <div class="step" id="step-2">
            <div class="card">
                <h2>Datum w√§hlen</h2>
                <div class="date-grid" id="date-list"></div>
                <div id="time-section" style="display:none;">
                    <h3 style="margin-top:20px; font-size:15px;">Uhrzeit w√§hlen</h3>
                    <div class="time-grid" id="time-list"></div>
                </div>
            </div>
            <div class="btn-row">
                <button class="btn btn-secondary" id="btn-back-1">Zur√ºck</button>
                <button class="btn btn-primary" id="btn-to-step3" disabled>Weiter</button>
            </div>
        </div>

        <!-- Step 3: Customer Data -->
        <div class="step" id="step-3">
            <div class="card">
                <h2>Ihre Daten</h2>
                <form id="booking-form">
                    <div class="form-group">
                        <label>Name <span class="required">*</span></label>
                        <input type="text" id="b-name" required placeholder="Max Mustermann">
                    </div>
                    <div class="form-group">
                        <label>E-Mail <span class="required">*</span></label>
                        <input type="email" id="b-email" required placeholder="max@beispiel.de">
                    </div>
                    <div class="form-group">
                        <label>Telefon</label>
                        <input type="tel" id="b-phone" placeholder="+49 123 456789">
                    </div>
                    <div class="form-group">
                        <label>Firma</label>
                        <input type="text" id="b-firma" placeholder="Firma (optional)">
                    </div>
                    <div class="form-group">
                        <label>Anmerkungen</label>
                        <textarea id="b-notes" placeholder="Zus√§tzliche Informationen..."></textarea>
                    </div>
                </form>
            </div>
            <div class="btn-row">
                <button class="btn btn-secondary" id="btn-back-2">Zur√ºck</button>
                <button class="btn btn-primary" id="btn-submit">Termin buchen</button>
            </div>
        </div>

        <!-- Step 4: Confirmation -->
        <div class="step" id="step-4">
            <div class="card confirmation">
                <div class="check">&#10003;</div>
                <h2>Termin gebucht!</h2>
                <p>Ihr Best√§tigungscode:</p>
                <div class="code" id="confirm-code"></div>
                <table class="summary-table" id="confirm-summary"></table>
                <p style="margin-top:16px; font-size:13px; color:var(--text-muted);">
                    Sie erhalten eine Best√§tigung per E-Mail.
                </p>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; 2026 FreyAI Visions | <a href="index.html">Zur App</a></p>
    </div>

    <!-- Minimal dependencies -->
    <script src="js/services/booking-service.js"></script>
    <script>
        // Initialize booking service for public use
        const bs = window.bookingService || new BookingService();

        // State
        let selectedService = null;
        let selectedDate = null;
        let selectedTime = null;

        // Pre-select service from URL
        const urlParams = new URLSearchParams(window.location.search);
        const presetService = urlParams.get('service');

        // Step Navigation
        function goToStep(n) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step-${n}`).classList.add('active');
            document.querySelectorAll('.step-dot').forEach(d => {
                const s = parseInt(d.dataset.step);
                d.classList.toggle('active', s === n);
                d.classList.toggle('done', s < n);
            });
        }

        // Step 1: Render services
        function renderServices() {
            const types = bs.getServiceTypes();
            const icons = { beratung: 'üí¨', besichtigung: 'üè†', reparatur: 'üîß', wartung: '‚öôÔ∏è' };
            const grid = document.getElementById('service-list');
            grid.innerHTML = types.map(t => `
                <div class="service-card" data-id="${t.id}">
                    <div class="icon">${icons[t.id] || 'üìã'}</div>
                    <div class="name">${t.name}</div>
                    <div class="meta">${t.duration} Min.${t.price > 0 ? ' ¬∑ ' + t.price + ' ‚Ç¨' : ' ¬∑ Kostenlos'}</div>
                </div>
            `).join('');

            grid.querySelectorAll('.service-card').forEach(card => {
                card.addEventListener('click', () => {
                    grid.querySelectorAll('.service-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    selectedService = card.dataset.id;
                    document.getElementById('btn-to-step2').disabled = false;
                });
            });

            // Pre-select from URL
            if (presetService) {
                const preset = grid.querySelector(`[data-id="${presetService}"]`);
                if (preset) preset.click();
            }
        }

        // Step 2: Render dates
        function renderDates() {
            const dates = bs.getAvailableDates(selectedService);
            const grid = document.getElementById('date-list');
            grid.innerHTML = dates.length ? dates.map(d => `
                <div class="date-card" data-date="${d.date}">
                    <div class="day">${d.dayName}</div>
                    <div class="date">${new Date(d.date).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' })}</div>
                    <div class="slots">${d.slotsAvailable} Termine frei</div>
                </div>
            `).join('') : '<p style="color:var(--text-muted);grid-column:1/-1;text-align:center;">Keine Termine verf√ºgbar</p>';

            document.getElementById('time-section').style.display = 'none';
            selectedDate = null;
            selectedTime = null;
            document.getElementById('btn-to-step3').disabled = true;

            grid.querySelectorAll('.date-card').forEach(card => {
                card.addEventListener('click', () => {
                    grid.querySelectorAll('.date-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    selectedDate = card.dataset.date;
                    renderTimeSlots();
                });
            });
        }

        // Step 2: Render time slots
        function renderTimeSlots() {
            const slots = bs.getAvailableSlots(selectedService, selectedDate);
            const grid = document.getElementById('time-list');
            document.getElementById('time-section').style.display = 'block';

            grid.innerHTML = slots.map(s => `
                <button class="time-btn" data-start="${s.start}" data-end="${s.end}">${s.start} Uhr</button>
            `).join('');

            selectedTime = null;
            document.getElementById('btn-to-step3').disabled = true;

            grid.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    grid.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedTime = { start: btn.dataset.start, end: btn.dataset.end };
                    document.getElementById('btn-to-step3').disabled = false;
                });
            });
        }

        // Submit booking
        function submitBooking() {
            const name = document.getElementById('b-name').value.trim();
            const email = document.getElementById('b-email').value.trim();
            const phone = document.getElementById('b-phone').value.trim();
            const firma = document.getElementById('b-firma').value.trim();
            const notes = document.getElementById('b-notes').value.trim();

            if (!name || !email) return;
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                alert('Bitte g√ºltige E-Mail-Adresse eingeben.');
                return;
            }

            const booking = bs.createBooking({
                serviceType: selectedService,
                date: selectedDate,
                startTime: selectedTime.start,
                endTime: selectedTime.end,
                customer: { name, email, telefon: phone, firma },
                notes
            });

            // Show confirmation
            document.getElementById('confirm-code').textContent = booking.confirmationCode;
            const service = bs.getServiceType(selectedService);
            document.getElementById('confirm-summary').innerHTML = `
                <tr><td>Leistung</td><td>${service.name}</td></tr>
                <tr><td>Datum</td><td>${new Date(selectedDate).toLocaleDateString('de-DE', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' })}</td></tr>
                <tr><td>Uhrzeit</td><td>${selectedTime.start} - ${selectedTime.end} Uhr</td></tr>
                <tr><td>Name</td><td>${name}</td></tr>
                <tr><td>E-Mail</td><td>${email}</td></tr>
                ${phone ? `<tr><td>Telefon</td><td>${phone}</td></tr>` : ''}
            `;

            goToStep(4);
        }

        // Event Listeners
        document.getElementById('btn-to-step2').addEventListener('click', () => { renderDates(); goToStep(2); });
        document.getElementById('btn-to-step3').addEventListener('click', () => goToStep(3));
        document.getElementById('btn-back-1').addEventListener('click', () => goToStep(1));
        document.getElementById('btn-back-2').addEventListener('click', () => goToStep(2));
        document.getElementById('btn-submit').addEventListener('click', submitBooking);

        // Init
        renderServices();
    </script>
</body>
</html>
